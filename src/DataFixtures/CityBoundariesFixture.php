<?php

namespace App\DataFixtures;

use App\Entity\City;
use App\Repository\CityRepository;
use Doctrine\Bundle\FixturesBundle\Fixture;
use Doctrine\Persistence\ObjectManager;

class CityBoundariesFixture extends Fixture
{
    // Approximate boundary polygons for major Tunisian cities
    // Format: [city_name => [[lat, lng], [lat, lng], ...]]
    private const CITY_BOUNDARIES = [
        'Tunis' => [
            [36.8500, 10.1400], [36.8600, 10.1600], [36.8700, 10.1800],
            [36.8800, 10.2000], [36.8700, 10.2200], [36.8500, 10.2300],
            [36.8300, 10.2200], [36.8100, 10.2100], [36.7900, 10.1900],
            [36.7800, 10.1700], [36.7900, 10.1500], [36.8100, 10.1400],
            [36.8300, 10.1300], [36.8500, 10.1400]
        ],
        'Sfax' => [
            [34.7800, 10.7200], [34.7900, 10.7400], [34.7900, 10.7600],
            [34.7800, 10.7800], [34.7700, 10.8000], [34.7500, 10.8000],
            [34.7300, 10.7900], [34.7100, 10.7700], [34.7000, 10.7500],
            [34.7100, 10.7300], [34.7300, 10.7200], [34.7500, 10.7100],
            [34.7700, 10.7100], [34.7800, 10.7200]
        ],
        'Sousse' => [
            [35.8700, 10.6000], [35.8800, 10.6200], [35.8800, 10.6400],
            [35.8700, 10.6600], [35.8500, 10.6700], [35.8300, 10.6700],
            [35.8100, 10.6600], [35.8000, 10.6400], [35.8000, 10.6200],
            [35.8100, 10.6000], [35.8300, 10.5900], [35.8500, 10.5900],
            [35.8700, 10.6000]
        ],
        'Kairouan' => [
            [35.7100, 10.0600], [35.7200, 10.0800], [35.7200, 10.1000],
            [35.7100, 10.1200], [35.6900, 10.1300], [35.6700, 10.1300],
            [35.6500, 10.1200], [35.6400, 10.1000], [35.6400, 10.0800],
            [35.6500, 10.0600], [35.6700, 10.0500], [35.6900, 10.0500],
            [35.7100, 10.0600]
        ],
        'Bizerte' => [
            [37.3100, 9.8400], [37.3200, 9.8600], [37.3200, 9.8800],
            [37.3100, 9.9000], [37.2900, 9.9100], [37.2700, 9.9100],
            [37.2500, 9.9000], [37.2400, 9.8800], [37.2400, 9.8600],
            [37.2500, 9.8400], [37.2700, 9.8300], [37.2900, 9.8300],
            [37.3100, 9.8400]
        ],
        'GabÃ¨s' => [
            [33.9200, 10.0600], [33.9300, 10.0800], [33.9300, 10.1000],
            [33.9200, 10.1200], [33.9000, 10.1300], [33.8800, 10.1300],
            [33.8600, 10.1200], [33.8500, 10.1000], [33.8500, 10.0800],
            [33.8600, 10.0600], [33.8800, 10.0500], [33.9000, 10.0500],
            [33.9200, 10.0600]
        ],
        'Ariana' => [
            [36.9000, 10.1600], [36.9100, 10.1800], [36.9100, 10.2000],
            [36.9000, 10.2200], [36.8800, 10.2300], [36.8600, 10.2300],
            [36.8400, 10.2200], [36.8300, 10.2000], [36.8300, 10.1800],
            [36.8400, 10.1600], [36.8600, 10.1500], [36.8800, 10.1500],
            [36.9000, 10.1600]
        ],
        'Gafsa' => [
            [34.4600, 8.7500], [34.4700, 8.7700], [34.4700, 8.7900],
            [34.4600, 8.8100], [34.4400, 8.8200], [34.4200, 8.8200],
            [34.4000, 8.8100], [34.3900, 8.7900], [34.3900, 8.7700],
            [34.4000, 8.7500], [34.4200, 8.7400], [34.4400, 8.7400],
            [34.4600, 8.7500]
        ],
        'Monastir' => [
            [35.8100, 10.7900], [35.8200, 10.8100], [35.8200, 10.8300],
            [35.8100, 10.8500], [35.7900, 10.8600], [35.7700, 10.8600],
            [35.7500, 10.8500], [35.7400, 10.8300], [35.7400, 10.8100],
            [35.7500, 10.7900], [35.7700, 10.7800], [35.7900, 10.7800],
            [35.8100, 10.7900]
        ],
        'Nabeul' => [
            [36.4900, 10.7000], [36.5000, 10.7200], [36.5000, 10.7400],
            [36.4900, 10.7600], [36.4700, 10.7700], [36.4500, 10.7700],
            [36.4300, 10.7600], [36.4200, 10.7400], [36.4200, 10.7200],
            [36.4300, 10.7000], [36.4500, 10.6900], [36.4700, 10.6900],
            [36.4900, 10.7000]
        ],
        'Hammamet' => [
            [36.4400, 10.5800], [36.4500, 10.6000], [36.4500, 10.6200],
            [36.4400, 10.6400], [36.4200, 10.6500], [36.4000, 10.6500],
            [36.3800, 10.6400], [36.3700, 10.6200], [36.3700, 10.6000],
            [36.3800, 10.5800], [36.4000, 10.5700], [36.4200, 10.5700],
            [36.4400, 10.5800]
        ],
        'Mahdia' => [
            [35.5300, 11.0300], [35.5400, 11.0500], [35.5400, 11.0700],
            [35.5300, 11.0900], [35.5100, 11.1000], [35.4900, 11.1000],
            [35.4700, 11.0900], [35.4600, 11.0700], [35.4600, 11.0500],
            [35.4700, 11.0300], [35.4900, 11.0200], [35.5100, 11.0200],
            [35.5300, 11.0300]
        ],
        'Tozeur' => [
            [33.9500, 8.1000], [33.9600, 8.1200], [33.9600, 8.1400],
            [33.9500, 8.1600], [33.9300, 8.1700], [33.9100, 8.1700],
            [33.8900, 8.1600], [33.8800, 8.1400], [33.8800, 8.1200],
            [33.8900, 8.1000], [33.9100, 8.0900], [33.9300, 8.0900],
            [33.9500, 8.1000]
        ],
    ];

    public function __construct(private CityRepository $cityRepository)
    {
    }

    public function load(ObjectManager $manager): void
    {
        foreach (self::CITY_BOUNDARIES as $cityName => $coordinates) {
            $city = $this->cityRepository->findOneBy(['name' => $cityName]);
            
            if ($city) {
                // Convert coordinates to JSON format
                $boundary = json_encode($coordinates);
                $city->setBoundary($boundary);
                $manager->persist($city);
            }
        }

        $manager->flush();
    }
}

